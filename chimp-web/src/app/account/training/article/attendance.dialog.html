<div class="attendance-dialog">
  <div class="dialog-header">
    <div class="header-content">
      <div class="header-icon">
        <mat-icon>groups</mat-icon>
      </div>
      <div class="header-text">
        <h2>Select Attendees</h2>
        <p>Choose who needs to receive this training</p>
      </div>
    </div>
  </div>

  <div class="dialog-body">
    <div class="search-bar">
      <mat-icon>search</mat-icon>
      <input 
        type="text" 
        placeholder="Search team members..." 
        [(ngModel)]="searchTerm"
        (input)="filterUsers()">
      @if (searchTerm) {
        <button mat-icon-button class="clear-btn" (click)="clearSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </div>

    <div class="selection-controls">
      <button mat-stroked-button class="select-all-btn" (click)="toggleSelectAll()">
        <mat-icon>{{ allSelected ? 'check_box' : 'check_box_outline_blank' }}</mat-icon>
        {{ allSelected ? 'Deselect All' : 'Select All' }}
      </button>
      <div class="selection-count">
        <span class="count-badge" [class.has-selection]="selectedUsers.length > 0">
          {{ selectedUsers.length }}
        </span>
        <span class="count-label">selected</span>
      </div>
    </div>

    @if (filteredUsers.length === 0) {
      <div class="empty-state">
        <mat-icon>person_search</mat-icon>
        <div class="empty-title">No team members found</div>
        <div class="empty-body">Try adjusting your search terms.</div>
      </div>
    } @else {
      <div class="users-list">
        @for (user of filteredUsers; track user.id) {
          <div 
            class="user-card" 
            [class.selected]="isSelected(user.id)"
            (click)="toggleUser(user)">
            <div class="user-avatar" [class.has-image]="user.profileUrl">
              @if (user.profileUrl) {
                <img [src]="user.profileUrl" alt="">
              }
              <div class="selection-indicator">
                <mat-icon>check</mat-icon>
              </div>
            </div>
            <div class="user-info">
              <div class="user-name">{{ user.name }}</div>
              @if (user.preferEmail && user.email) {
                <div class="user-contact">{{ user.email }}</div>
              } @else if (user.phone) {
                <div class="user-contact">{{ user.phone }}</div>
              }
            </div>
          </div>
        }
      </div>
    }
  </div>

  <div class="dialog-footer">
    <button mat-stroked-button (click)="cancel()">Cancel</button>
    <button 
      mat-flat-button 
      color="accent" 
      [disabled]="selectedUsers.length === 0"
      (click)="save()">
      <mat-icon>play_circle</mat-icon>
      Start Training ({{ selectedUsers.length }})
    </button>
  </div>
</div>
