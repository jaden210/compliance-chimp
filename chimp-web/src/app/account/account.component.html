<mat-sidenav-container>
  <mat-sidenav #sidenav mode="over" position="start">
    <div class="mobile-nav">
      <ng-container *ngFor="let item of navItems">
        <div 
          *ngIf="!item.devOnly || accountService.user?.isDev"
          class="mobile-nav-item" 
          routerLinkActive="bactive" 
          [routerLink]="item.route"
          (click)="sidenav.close(); onNavClick(item)">
          <mat-icon>{{item.icon}}</mat-icon>
          <span>{{item.label}}</span>
        </div>
      </ng-container>
      
      <!-- ChimpChat Button (Mobile) -->
      <div class="mobile-nav-item chimp-chat-mobile" (click)="sidenav.close(); toggleChimpChat()">
        <img src="/assets/chimpFace.png" alt="ChimpChat" class="chimp-chat-icon" />
        <span>ChimpChat</span>
      </div>
    </div>
  </mat-sidenav>
  
  <!-- ChimpChat Sidenav (Right side) -->
  <mat-sidenav #chatSidenav mode="side" position="end" 
    [opened]="showChimpChat && chatMode === 'sidenav'"
    class="chat-sidenav">
    <chimp-chat 
      mode="sidenav"
      [initialMessage]="pendingChatMessage"
      (close)="closeChimpChat()"
      (modeChange)="onChatModeChange($event)"
      (messageConsumed)="pendingChatMessage = null">
    </chimp-chat>
  </mat-sidenav>
  
  <mat-sidenav-content>
    <!-- ***** HELPER ***** -->
    <!-- <div class="helper" id="helper-color" *ngIf="accountService.showHelper" [@helper]>
      <div class="helper-box">
        <button mat-icon-button class="helper-close" (click)="closeHelper()"><mat-icon>cancel</mat-icon></button>
        <div class="helper-name" id="helper-name-color">{{ accountService.helper?.name }}</div>
        <div class="helper-description" id="helper-description-color" [innerHTML]="accountService.helper?.description"></div>
      </div>
    </div> -->
    <div class="helper" *ngIf="accountService.showFeedback" [@helper]>
      <button mat-icon-button class="helper-close" (click)="accountService.showFeedback = false"><mat-icon>cancel</mat-icon></button>
      <div class="helper-name">{{ accountService.feedback?.name }}</div>
      <mat-form-field class="helper-input" color="primary"
        ><textarea
          matInput
          placeholder="help Compliancechimp work harder for you"
          [(ngModel)]="accountService.feedback.description"
        ></textarea
      ></mat-form-field>
      <button
        mat-stroked-button
        class="helper-button"
        (click)="submitFeedback()"
        color="accent"
      >
        SUBMIT
      </button>
    </div>
    <div id="wrapper">
      <div id="left">
        <ng-container *ngFor="let item of navItems">
          <div 
            *ngIf="!item.devOnly || accountService.user?.isDev"
            class="side-button" 
            [class.compact]="isCompact(item.key)"
            routerLinkActive="bactive" 
            [routerLink]="item.route"
            (click)="onNavClick(item)"
            [style.flex-grow]="getNavItemFlex(item.key)">
            <mat-icon>{{item.icon}}</mat-icon>
            <span class="nav-label">{{item.label}}</span>
          </div>
        </ng-container>
        
        <!-- ChimpChat Button -->
        <div class="chimp-chat-button" [class.active]="showChimpChat" (click)="toggleChimpChat()">
          <img src="/assets/chimpFace.png" alt="ChimpChat" />
        </div>
      </div>
      <div id="body">
        <router-outlet></router-outlet>
      </div>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>
<div
  class="account-popup-overlay"
  *ngIf="bShowAccountInfo"
  (click)="bShowAccountInfo = false"
></div>
<div class="account-popup" *ngIf="bShowAccountInfo">
  <div class="row">
    <div class="teams">
      <img
        id="popimage"
        src="{{accountService.aTeam.logoUrl}}"
        onError="src = '/assets/lost.png'"
        alt="Compliancechimp"
      />
      <div class="flex"></div>
      <ng-container *ngFor="let team of accountService.userTeams">
        <img
          *ngIf="team.id !== accountService.aTeam.id"
          [matTooltip]="team.name"
          (click)="
            bShowAccountInfo = false; accountService.setActiveTeam(team.id)
          "
          class="otherteams"
          src="{{team.logoUrl}}"
          onerror="src = '/assets/lost.png'"
          alt="Compliancechimp"
        />
      </ng-container>
    </div>
    <div id="popteamname">{{ accountService.aTeam.name }}</div>
  </div>
  <div id="popteam">{{ accountService.teamMembers?.length }} team members</div>
  <div id="popteam">
    member since {{ accountService.aTeam.createdAt | date: "shortDate" }}
  </div>
</div>

<!-- ChimpChat Panel (Dialog mode) -->
<chimp-chat 
  *ngIf="showChimpChat && chatMode === 'dialog'" 
  mode="dialog"
  [initialMessage]="pendingChatMessage"
  (close)="closeChimpChat()"
  (modeChange)="onChatModeChange($event)"
  (messageConsumed)="pendingChatMessage = null">
</chimp-chat>

<loading-chimp></loading-chimp>