<!-- Interstitial Overlay -->
@if (showOverlay) {
  <div class="interstitial-overlay" @overlayFade (click)="dismissOverlay()">
    <div class="interstitial-content" (click)="$event.stopPropagation()" @chimpPop>
      <img src="assets/thought.png" alt="Ulysses" class="interstitial-chimp" />

      <div class="speech-bubble">
        @if (overlayFact) {
          <p class="interstitial-fact" @factReveal>{{ overlayFact }}</p>
        } @else {
          <div class="interstitial-loading">
            <div class="typing-dots"><span></span><span></span><span></span></div>
          </div>
        }
      </div>
    </div>

    <div class="interstitial-footer">
      <div class="interstitial-progress">
        <div class="interstitial-progress-fill" [style.width.%]="overlayProgress"></div>
      </div>
      <button class="interstitial-skip" (click)="dismissOverlay()">Continue</button>
    </div>
  </div>
}

<div class="step-container">
  <div class="step-card">
    <div class="step-header">
      <div class="step-indicator">Step 1 of 4</div>
      <h1>Tell us about your business</h1>
      <p class="step-subtitle">We'll use this to build your custom compliance program.</p>
    </div>

    <div class="form-section">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Business Name</mat-label>
        <input
          matInput
          [(ngModel)]="businessName"
          (ngModelChange)="onBusinessNameChange()"
          placeholder="Acme Construction LLC"
          (keyup.enter)="next()"
        />
      </mat-form-field>

      <div class="website-field-wrapper">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Business Website (optional)</mat-label>
          <input
            matInput
            [(ngModel)]="businessWebsite"
            (ngModelChange)="onBusinessWebsiteChange()"
            placeholder="www.example.com"
            (keyup.enter)="next()"
          />
          <mat-hint>Helps us personalize your program</mat-hint>
        </mat-form-field>
        <button
          mat-icon-button
          class="website-help-btn"
          (click)="openWebsiteHelpDialog()"
          aria-label="Why do we ask for your website?"
        >
          <mat-icon>help_outline</mat-icon>
        </button>
      </div>

      <div class="industry-field-wrapper">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>What does your business do?</mat-label>
          <textarea
            matInput
            cdkTextareaAutosize
            cdkAutosizeMinRows="1"
            cdkAutosizeMaxRows="4"
            [(ngModel)]="industry"
            (ngModelChange)="onIndustryChange()"
            placeholder="Residential framing, remodeling, and roof repair"
            (keydown.enter)="$event.preventDefault(); next()"
          ></textarea>
          <mat-hint>Be specific for a better safety program</mat-hint>
        </mat-form-field>

        @if (isSuggestingIndustry) {
        <mat-progress-bar
          mode="indeterminate"
          class="suggestion-loading"
        ></mat-progress-bar>
        }

        @if (industrySuggestion && !suggestionDismissed) {
        <div
          class="industry-suggestion"
          (click)="applySuggestion()"
        >
          <div class="suggestion-content">
            <mat-icon class="suggestion-icon">auto_awesome</mat-icon>
            <div class="suggestion-text">
              <span class="suggestion-label">Suggested</span>
              <span class="suggestion-value">{{ industrySuggestion }}</span>
            </div>
          </div>
          <button
            mat-icon-button
            class="suggestion-dismiss"
            (click)="dismissSuggestion(); $event.stopPropagation()"
            aria-label="Dismiss suggestion"
          >
            <mat-icon>close</mat-icon>
          </button>
        </div>
        }
      </div>
    </div>

    <div class="step-actions">
      <button
        mat-button
        class="back-btn"
        routerLink="/get-started/welcome"
      >
        <mat-icon>arrow_back</mat-icon>
        Back
      </button>
      <button
        mat-flat-button
        color="accent"
        class="next-btn"
        [disabled]="!isValid()"
        (click)="next()"
      >
        Next
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
  </div>
</div>
