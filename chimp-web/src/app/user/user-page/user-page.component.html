<div class="user-page">
  <!-- Hero Header -->
  <header class="hero">
    <div class="hero-bg"></div>
    <div class="hero-content">
      @if (Team?.logoUrl) {
        <div class="team-branding">
          <img class="team-logo" [src]="Team.logoUrl" [alt]="Team.name">
        </div>
      }
      <h1 class="greeting">Hey, {{ TeamMember?.name?.split(' ')[0] || 'there' }}! ðŸ‘‹</h1>
      <p class="team-name">{{ Team?.name }}</p>
    </div>
  </header>

  <main class="content">
    <!-- PWA Install Prompt -->
    @if (pwaInstallService.canInstall$ | async) {
      <div class="install-prompt" (click)="installApp()">
        <div class="install-content">
          <div class="install-icon-wrap">
            <mat-icon>add_to_home_screen</mat-icon>
          </div>
          <div class="install-text">
            <strong>Add to Home Screen</strong>
            <span>Quick access anytime</span>
          </div>
        </div>
        <mat-icon class="install-arrow">arrow_forward</mat-icon>
      </div>
    }

    <!-- Quick Actions (top) â€” urgent/primary actions only -->
    <section class="actions-section">
      <div class="action-cards">
        <div class="action-card injury" (click)="startInjuryReport()">
          <div class="action-icon">
            <mat-icon>healing</mat-icon>
          </div>
          <div class="action-details">
            <span class="action-title">Report Incident</span>
            <span class="action-subtitle">Injury or near miss</span>
          </div>
          <mat-icon class="action-arrow">chevron_right</mat-icon>
        </div>

        @if (IsLoggedIn) {
          <div class="action-card training" routerLink="articles" queryParamsHandling="preserve">
            <div class="action-icon">
              <mat-icon>school</mat-icon>
            </div>
            <div class="action-details">
              <span class="action-title">Training</span>
              <span class="action-subtitle">Start a new session</span>
            </div>
            <mat-icon class="action-arrow">chevron_right</mat-icon>
          </div>

          <div class="action-card inspections" routerLink="self-inspections" queryParamsHandling="preserve">
            <div class="action-icon">
              <mat-icon>checklist</mat-icon>
            </div>
            <div class="action-details">
              <span class="action-title">Self-Inspections</span>
              <span class="action-subtitle">Safety checklists</span>
            </div>
            <mat-icon class="action-arrow">chevron_right</mat-icon>
          </div>
        }
      </div>
    </section>

    <!-- Sign-in Prompt (for managers/owners who aren't signed in) -->
    @if (hasAccountButNotSignedIn) {
      <section class="sign-in-section">
        <div class="sign-in-card">
          <div class="sign-in-content">
            <div class="sign-in-icon-wrap">
              <mat-icon>lock_open</mat-icon>
            </div>
            <div class="sign-in-text">
              <strong>Unlock more features</strong>
              <span>Sign in to access training, self-inspections, team management, and more.</span>
            </div>
          </div>
          <a class="sign-in-button" routerLink="/sign-in">
            Sign In
            <mat-icon>arrow_forward</mat-icon>
          </a>
        </div>
      </section>
    }

    <!-- Surveys Section -->
    <section class="surveys-section">
      <div class="section-header">
        <h2 class="section-title">Your Surveys</h2>
        @if (Surveys?.length) {
          <span class="survey-badge">{{ Surveys.length }}</span>
        }
      </div>

      @if (Surveys?.length) {
        <div class="survey-cards">
          @for (survey of Surveys; track survey.id) {
            <div class="survey-card" [routerLink]="'survey/' + survey.id" queryParamsHandling="preserve">
              <div class="survey-info">
                <span class="survey-title">{{ survey?.title }}</span>
                <span class="survey-meta">
                  @if (survey.author?.name) {
                    From {{ survey.author.name }} Â· 
                  }
                  {{ survey?.createdAt?.toDate() | date:'MMM d' }}
                </span>
              </div>
              <div class="survey-action">
                <mat-icon>arrow_forward</mat-icon>
              </div>
            </div>
          }
        </div>
      } @else if (!surveysLoaded) {
        <!-- Still loading surveys from server -->
        <div class="empty-state loading-state">
          <div class="empty-icon">
            <mat-icon>sync</mat-icon>
          </div>
          <h3>Checking for surveys...</h3>
          <p>Please wait while we load your latest surveys.</p>
        </div>
      } @else {
        <!-- Surveys loaded and confirmed empty -->
        <div class="empty-state">
          <div class="empty-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <h3>All caught up!</h3>
          <p>No surveys waiting for you. We'll notify you when something new arrives.</p>
        </div>
      }
    </section>

    <!-- Secondary Actions â€” below surveys -->
    @if (hasFilesOrResources || completedSurveyCount > 0) {
      <section class="actions-section secondary-actions">
        <div class="action-cards">
          @if (hasFilesOrResources) {
            <div class="action-card files" routerLink="files">
              <div class="action-icon">
                <mat-icon>folder_open</mat-icon>
              </div>
              <div class="action-details">
                <span class="action-title">Team Files</span>
                <span class="action-subtitle">{{ totalFilesCount }} file{{ totalFilesCount !== 1 ? 's' : '' }} available</span>
              </div>
              <mat-icon class="action-arrow">chevron_right</mat-icon>
            </div>
          }

          @if (completedSurveyCount > 0) {
            <div class="action-card history" routerLink="survey-history" queryParamsHandling="preserve">
              <div class="action-icon">
                <mat-icon>history</mat-icon>
              </div>
              <div class="action-details">
                <span class="action-title">Survey History</span>
                <span class="action-subtitle">{{ completedSurveyCount }} completed survey{{ completedSurveyCount !== 1 ? 's' : '' }}</span>
              </div>
              <mat-icon class="action-arrow">chevron_right</mat-icon>
            </div>
          }
        </div>
      </section>
    }

    <!-- Footer -->
    <footer class="page-footer">
      <span>Powered by</span>
      <img src="/assets/ccLogoDark.png" alt="Compliancechimp" class="footer-logo">
    </footer>
  </main>
</div>
